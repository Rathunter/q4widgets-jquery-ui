/*
Widget:   q4.rssfeed
Version:  1.1.0
Compiled: 2015-02-12
*/
!function(a){a.widget("q4.rssfeed",{options:{url:"",limit:0,dateFormat:"MMM D, YYYY h:mm A",summaryLength:500,proxy:!1,template:"",complete:function(){}},_create:function(){var a=this,b=this.options;$e=this.element,this._fetchFeed().done(function(c){var d=b.proxy?a._parseJSONFeed(c):a._parseXMLFeed(c);$e.append(Mustache.render(b.template,d)),a._trigger("complete")})},_fetchFeed:function(){var b=this.options;return b.proxy?a.ajax({url:"//ajax.googleapis.com/ajax/services/feed/load?v=1.0&q="+encodeURIComponent(b.url),dataType:"jsonp"}):a.get(b.url)},_sliceItems:function(a){return this.options.limit?a.slice(0,this.options.limit):a},_sliceSummary:function(a){var b=this.options.summaryLength;return b&&a.length>b?a.slice(0,b)+"...":a},_parseXMLFeed:function(b){var c=this,d=this.options,e=a(b).find("channel");return{title:e.children("title").text(),url:e.children("link").text(),date:moment(e.children("lastBuildDate").text(),"DD MMM YYYY hh:mm:ss").format(d.dateFormat),items:a.map(this.sliceItems(e.children("item")),function(b){var e=a(b),f=a.trim(e.children("description").text()),g=a.trim(a("<div>").html(f).text().replace(/\/*<!\[CDATA\[[\s\S]*?\]\]>\/*/g,""));return{title:e.children("title").text(),url:e.children("link").text(),date:moment(e.children("pubDate").text(),"DD MMM YYYY hh:mm:ss").format(d.dateFormat),body:f,summary:c._sliceSummary(g),firstLine:g.split("\n")[0]}})}},_parseJSONFeed:function(b){var c=this,d=this.options,b=b.responseData.feed;return{title:b.title,url:b.link,date:moment(b.lastBuildDate||"","DD MMM YYYY hh:mm:ss").format(d.dateFormat),items:a.map(this._sliceItems(b.entries),function(a){return{title:a.title,url:a.link,date:moment(a.publishedDate,"DD MMM YYYY hh:mm:ss").format(d.dateFormat),body:a.content,summary:c._sliceSummary(a.content),firstLine:a.content.split("\n")[0]}})}}})}(jQuery);