/*
Widget:   q4.financialtable
Version:  1.1.1
Compiled: 2015-02-02
*/
!function(a){a.widget("q4.financialTable",{options:{columns:0,firstYear:0,categories:[],shortTypes:{"Annual Report":"Annual","Supplemental Report":"Supplemental","First Quarter":"Q1","Second Quarter":"Q2","Third Quarter":"Q3","Fourth Quarter":"Q4"},template:"",complete:function(){}},_fetchFinancials:function(){var b=this,c=this.options,d={serviceDto:{ViewType:GetViewType(),ViewDate:GetViewDate(),RevisionNumber:GetRevisionNumber(),LanguageId:GetLanguageId(),Signature:GetSignature()},year:-1,reportSubTypeList:c.reportSubType};a.ajax({type:"POST",url:"/Services/FinancialReportService.svc/GetFinancialReportList",data:JSON.stringify(d),contentType:"application/json; charset=utf-8",dataType:"json",success:function(a){b._drawFinancialTable(a)}})},_drawFinancialTable:function(b){var c=this.options,d=[],e={},f={years:[],categories:[]};a.each(b.GetFinancialReportListResult,function(b,e){-1==a.inArray(e.ReportYear,d)&&(0==c.firstYear||e.ReportYear>=c.firstYear)&&d.push(e.ReportYear)}),d.sort(function(a,b){return b-a}),c.columns>0&&(d=d.slice(0,c.columns)),a.each(c.categories,function(b,c){e[c.title]={},a.each(d,function(a,b){e[c.title][b]=[]}),a.isArray(c.category)||(c.category=c.category?[c.category]:[]),a.isArray(c.reportType)||(c.reportType=c.reportType?[c.reportType]:[]),a.isArray(c.tags)||(c.tags=c.tags?[c.tags]:[])}),a.each(b.GetFinancialReportListResult,function(b,f){return-1==a.inArray(f.ReportYear,d)?!0:void a.each(f.Documents,function(b,d){a.each(c.categories,function(b,g){if(g.category.length&&-1==a.inArray(d.DocumentCategory,g.category))return!0;if(g.reportType.length&&-1==a.inArray(f.ReportSubType,g.reportType))return!0;if(g.tags.length&&!a(d.TagsList).filter(g.tags).length)return!0;var h={fileType:d.DocumentFileType,shortType:c.shortTypes[f.ReportSubType],size:d.DocumentFileSize,title:d.DocumentTitle,url:d.DocumentPath,year:f.ReportYear,category:d.DocumentCategory};h.text="text"in g?Mustache.render(g.text,h):"",e[g.title][f.ReportYear].push(h)})})}),a.each(d,function(a,b){f.years.push({year:b})}),a.each(c.categories,function(b,c){var g={catTitle:c.title,catClass:"cssClass"in c?c.cssClass:"",catYears:[]};a.each(d,function(a,b){b in e[c.title]?(e[c.title][b].reverse(),g.catYears.push({docs:e[c.title][b]})):g.catYears.push({docs:[]})}),f.categories.push(g)}),this.element.append(Mustache.render(c.template,f)),this._trigger("complete")},_create:function(){a.ajaxSetup({cache:!0}),this._fetchFinancials()}})}(jQuery);