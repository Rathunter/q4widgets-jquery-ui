/* Widget: q4.timeline */
/* Version: 1.0.0 */
/* Compiled on 2015-01-16 */
!function(a){a.widget("q4.timeline",{options:{content:[{heading:"1980s",text:"Many things happened in the 1980s.",items:[{heading:1981,cssClass:"green",text:"This is the first thing."},{heading:1985,cssClass:"blue",text:"This is the second thing."}]},{heading:"2000s",cssClass:"red",items:[{heading:"January 1, 2000",text:"In the year 2000, everything changed."}]}],navCarousel:!1,navContainer:".timeline-nav",navTemplate:'{{#groups}}<li class="{{cssClass}}"><h3>{{heading}}</h3>{{{text}}}</li>{{/groups}}',navSelector:"li",navOptions:{infinite:!1,slidesToShow:10},mainCarousel:!0,mainContainer:".timeline-main",mainTemplate:'{{#items}}<li class="{{cssClass}}" data-group="{{group}}"><h3>{{heading}}</h3><div class="itemtext">{{{text}}}</div></li>{{/items}}',mainSelector:"li",mainOptions:{infinite:!1,slidesToShow:3},afterNavChange:function(){},afterMainChange:function(){},complete:function(){}},drawTimeline:function(){var b=this.options,c=[],d=[],e=a(b.navContainer,this.element),f=a(b.mainContainer,this.element);a.each(b.content,function(b,e){c.push(e),a.each(e.items,function(a,c){c.group=b,d.push(c)})}),e.html(Mustache.render(b.navTemplate,{groups:c})),f.html(Mustache.render(b.mainTemplate,{items:d}))},initCarousels:function(){var b=this,c=b.options,d=a(c.navContainer,b.element),e=a(c.mainContainer,b.element),f=a(c.navSelector,d),g=a(c.mainSelector,e);if(c.navCarousel){var h={slide:c.navSelector};d.slick(a.extend({},h,c.navOptions))}if(c.mainCarousel){var i={slide:c.mainSelector,onAfterChange:function(a,c){var d=f.index(f.filter(".active")),h=g.eq(c).data("group");d!=h&&b.setActiveGroup(h),b._trigger("afterMainChange",null,{element:e,target:c})}};e.slick(a.extend({},i,c.mainOptions)),f.click(function(){if(!a(this).hasClass("active")){b.setActiveGroup(f.index(a(this)));var c=g.filter("[data-group="+f.index(a(this))+"]").first().index(),d=g.length-e.slickGetOption("slidesToShow");e.slickGoTo(Math.min(c,d))}})}b.setActiveGroup(0)},setActiveGroup:function(b){{var c=this.options,d=a(c.navContainer,this.element),e=a(c.navSelector,d).removeClass("active");e.eq(b).addClass("active")}c.navCarousel&&(b<a(".slick-active",d).first().index()?d.slickGoTo(b):b>a(".slick-active",d).last().index()&&d.slickGoTo(b-d.slickGetOption("slidesToShow")+1)),this._trigger("afterNavChange",null,{element:d,target:b})},_create:function(){this.options;a.ajaxSetup({cache:!0}),this.drawTimeline(),this.initCarousels(),this._trigger("complete")}})}(jQuery);