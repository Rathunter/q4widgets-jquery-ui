/* Widget: q4.flickrGallery */
/* Version: 1.0.0 */
/* Compiled on 2015-01-16 */
!function(a){a.widget("q4.flickrGallery",{options:{apiKey:"",userId:"",albums:[],perPage:500,template:"",complete:function(){}},sizes:{Square:"_s",LargeSquare:"_q",Thumbnail:"_t",Small:"_m",Small320:"_n",Medium:"",Medium640:"_z",Medium800:"_c",Large:"_b",Original:"_o"},albums:[],_create:function(){this._drawGallery()},_drawGallery:function(){var b=this,c=this.options,d=this.element;a.ajax({url:"https://api.flickr.com/services/rest/?method=flickr.photosets.getList",data:{api_key:c.apiKey,user_id:c.userId,format:"json"},dataType:"jsonp",jsonp:"jsoncallback",success:function(a){return"ok"!=a.stat?void console.error("Flickr error: "+a.message):void b._parsePhotosets(a).done(function(){d.append(Mustache.render(c.template,{albums:b.albums})),b._trigger("complete")})}})},_parsePhotosets:function(b){var c=this,d=this.options,e=[],f=[];return d.albums.length?a.each(d.albums,function(c,d){a.each(b.photosets.photoset,function(a,b){b.title._content==d&&f.push(b)})}):f=b.photosets.photoset,a.each(f,function(b,f){var g=[],h=["description","url_o"];e.push(a.ajax({url:"https://api.flickr.com/services/rest/?method=flickr.photosets.getPhotos",data:{api_key:d.apiKey,photoset_id:f.id,per_page:d.perPage,extras:h.join(),format:"json"},dataType:"jsonp",jsonp:"jsoncallback",success:function(d){a.each(d.photoset.photo,function(a,b){var d="https://farm"+b.farm+".static.flickr.com/"+b.server+"/"+b.id+"_"+b.secret;g.push({photoID:b.id,photoTitle:b.title,photoDesc:b.description._content,photoIndex:a+1,url:c._generateUrls(d)})}),c.albums[b]={albumID:f.id,albumTitle:f.title._content,albumDesc:f.description._content,albumIndex:b+1,photos:g,photoCount:g.length}}}))}),a.when.apply(this,e)},_generateUrls:function(b){var c={};return a.each(this.sizes,function(a,d){c[a]=b+d+".jpg"}),c}})}(jQuery);