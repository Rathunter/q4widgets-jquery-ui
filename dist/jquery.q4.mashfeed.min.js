/*! Compiled on 2015-01-08 */
!function(a){a.widget("q4.mashfeed",{options:{limit:0,dateFormat:"MMM D, YYYY h:mm A",fromNow:!1,summaryLength:500,feeds:[],filter:[],template:'<li><h2><a href="{{url}}">{{title}}</a></h2><p>{{date}}</p>{{summary}}</li>',complete:function(){}},feedTypes:{rss:{fetch:function(b){return a.ajax({url:"//ajax.googleapis.com/ajax/services/feed/load?v=1.0&q="+encodeURIComponent(b.url),dataType:"jsonp"})},getItems:function(a){return a.responseData.feed.entries},parseItem:function(a){return{title:a.title,url:a.link,date:moment(a.publishedDate,"DD MMM YYYY hh:mm:ss"),content:a.content}}},twitter:{fetch:function(b){return a.ajax({url:b.url,dataType:"jsonp"})},getItems:function(a){return a},parseItem:function(a){return{user:a.user.screen_name,username:a.user.name,content:a.text,date:moment(a.created_at,"ddd MMM DD hh:mm:ss ZZ YYYY"),id:a.id}}},youtube:{fetch:function(b){return a.ajax({url:"//gdata.youtube.com/feeds/users/"+b.username+"/uploads?alt=json-in-script&callback=?",dataType:"jsonp"})},getItems:function(a){return a.feed.entry},parseItem:function(b){return{title:b.title.$t,url:b.link[0].href,id:b.id.$t.split("/").pop(),date:moment(b.updated.$t),content:b.content.$t,thumb:a(b.content.$t).find("img").eq(0).attr("src")}}}},items:[],updateFilter:function(a){this.options.filter=a||[],this._renderFeeds()},_init:function(){var a=this;this._fetchFeeds().done(function(){a._renderFeeds()})},_fetchFeeds:function(){var b=this,c=this.options;this.items=[];var d=a.map(c.feeds,function(a){return b.feedTypes[a.type].fetch.call(b,a)});return a.when.apply(a,d).done(function(){a.each(arguments,function(d,e){var f=e[0],g=c.feeds[d],h=b.feedTypes[g.type],i=h.getItems(f);c.limit>0&&(i=i.slice(0,c.limit)),a.each(i,function(c,d){b.items.push(a.extend({feed:g},h.parseItem.call(b,d)))})}),b.items.sort(function(a,b){return b.date.diff(a.date)})})},_renderFeeds:function(){var b=this.options,c=this.element.empty(),d=0;a.isArray(b.filter)||(b.filter=[b.filter]),a.each(this.items,function(e,f){if(b.filter.length&&-1==a.inArray(f.feed.name,b.filter))return!0;if(b.limit>0&&d==b.limit)return!1;d++;var g=a.trim(a("<div>").html(f.content).text());c.append(Mustache.render(f.feed.template||b.template,a.extend({},f,{date:b.fromNow?f.date.fromNow():f.date.format(b.dateFormat),summary:g.slice(0,f.feed.summaryLength||b.summaryLength),firstLine:g.split("\n")[0]})))}),this._trigger("complete")}})}(jQuery);