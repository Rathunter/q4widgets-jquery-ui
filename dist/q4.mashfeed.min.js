/* Widget: q4.mashfeed */
/* Version: 1.0.0 */
/* Compiled on 2015-01-16 */
!function(a){a.widget("q4.mashfeed",{options:{limit:0,dateFormat:"MMM D, YYYY h:mm A",fromNow:!1,titleLength:80,summaryLength:500,feeds:[],filter:[],template:"",complete:function(){}},feedTypes:{rss:{fetch:function(b){return a.ajax({url:"//ajax.googleapis.com/ajax/services/feed/load?v=1.0&q="+encodeURIComponent(b.url),dataType:"jsonp"})},getItems:function(a){return a.responseData.feed.entries},parseItem:function(a){return{title:a.title,url:a.link,date:moment(a.publishedDate,"DD MMM YYYY hh:mm:ss"),content:a.content}}},twitter:{fetch:function(b){return a.ajax({url:b.url,dataType:"jsonp"})},getItems:function(a){return a},parseItem:function(a){return{user:a.user.screen_name,username:a.user.name,content:a.text,date:moment(a.created_at,"ddd MMM DD hh:mm:ss ZZ YYYY"),id:a.id_str}}},facebook:{fetch:function(b){return a.ajax({url:b.url,dataType:"jsonp"})},getItems:function(a){return a.entries},parseItem:function(a){return{title:a.title,url:a.alternate,id:a.id,date:moment(a.published),content:a.text}}},youtube:{fetch:function(b){return a.ajax({url:"//gdata.youtube.com/feeds/users/"+b.username+"/uploads?alt=json-in-script&callback=?",dataType:"jsonp"})},getItems:function(a){return a.feed.entry},parseItem:function(b){return{title:b.title.$t,url:b.link[0].href,id:b.id.$t.split("/").pop(),date:moment(b.updated.$t),content:b.content.$t,thumb:a(b.content.$t).find("img").eq(0).attr("src")}}},custom_jsonp:{fetch:function(b){return a.ajax({url:b.url,data:b.params,dataType:"jsonp"})},getItems:function(a){return a},parseItem:function(a){return a}}},items:[],updateFilter:function(a){this.options.filter=a||[],this._renderFeeds()},_init:function(){var a=this;this._fetchFeeds().done(function(){a._renderFeeds()})},_fetchFeeds:function(){var b=this,c=this.options;this.items=[];var d=a.map(c.feeds,function(a){return"function"==typeof a.fetch?a.fetch.call(b,a):b.feedTypes[a.type].fetch.call(b,a)});return a.when.apply(a,d).done(function(){a.each(arguments,function(d,e){var f=e[0],g=c.feeds[d],h=b.feedTypes[g.type],i="function"==typeof g.getItems?g.getItems.call(b,f):h.getItems.call(b,f);c.limit>0&&(i=i.slice(0,c.limit)),g.limit>0&&(i=i.slice(0,g.limit)),a.each(i,function(c,d){b.items.push(a.extend({feed:g},"function"==typeof g.parseItem?g.parseItem.call(b,d):h.parseItem.call(b,d)))})}),b.items.sort(function(a,b){return b.date.diff(a.date)})})},_renderFeeds:function(){function b(a,b){return b&&a.length>b?a.slice(0,b)+"...":a}var c=this.options,d=this.element.empty(),e=0;a.isArray(c.filter)||(c.filter=[c.filter]),a.each(this.items,function(f,g){if(c.filter.length&&-1==a.inArray(g.feed.name,c.filter))return!0;if(c.limit>0&&e==c.limit)return!1;if(e++,"title"in g&&(g.title=b(g.title,g.feed.titleLength||c.titleLength)),"date"in g&&(g.date=c.fromNow?g.date.fromNow():g.date.format(c.dateFormat)),"content"in g){var h=a.trim(a("<div>").html(g.content).text());g.summary=b(h,g.feed.summaryLength||c.summaryLength),g.firstLine=h.split("\n")[0]}d.append(Mustache.render(g.feed.template||c.template,g))}),this._trigger("complete")}})}(jQuery);