/*
Widget:   q4.calendar
Version:  1.1.0
Compiled: 2015-02-20
*/
!function(a){a.widget("q4.calendar",{options:{publicFeed:!1,url:"",apiKey:"",news:!1,presentations:!1,slideshare:"",onEventsLoad:function(){},onSlideShareLoad:function(){},eventSize:25,tags:[],calendar:{multiDayEvents:{startDate:"startDate",endDate:"endDate"},template:'<div class="clndrContainer"><div class="controls"><div class="clndr-previous-button">&lsaquo;</div><div class="month"><%= month %> <%= year %></div><div class="clndr-next-button">&rsaquo;</div></div><div class="days-container"><div class="days"><div class="headers"><% _.each(daysOfTheWeek, function(day) { %><div class="day-header"> <%= day %> </div><% }) %></div><% _.each(days, function(day) { %><% if (day.events[0] !== undefined) {%><div class="<%= day.classes %> <%= day.events[0].tag %> "> <%= day.day %><% _.each(day.events, function(event) { %><% if (event.slideshare) %><span class="slideshare"></span><% else %><span></span><% }) %></div><%} else %><div class="<%= day.classes %>"><%= day.day %></div><% }); %></div></div></div></div>',weekOffset:0,daysOfTheWeek:["S","M","T","W","T","F","S"],showAdjacentMonths:!0,adjacentDaysChangeMonth:!1,ready:function(){},doneRendering:function(){},clickEvents:{click:function(){},nextMonth:function(){},previousMonth:function(){},nextYear:function(){},previousYear:function(){},onMonthChange:function(){},onYearChange:function(){},today:function(){}}}},_create:function(){a.ajaxSetup({cache:!0})},_init:function(){this.callClndr()},publicEventParams:function(){var a=this.options,b={apiKey:a.apiKey,pageSize:a.eventSize,includeTags:!0,eventSelection:3,test:null,sortOperator:1,EventDateFilter:3,includePressReleases:a.news,includePresentations:a.presentations,includeFinancialReports:a.financials,tagList:a.tags.join("|")};return b},privateEventParams:function(){var a=this.options,b={serviceDto:{ViewType:GetViewType(),ViewDate:GetViewDate(),Signature:GetSignature(),LanguageId:GetLanguageId(),RevisionNumber:GetRevisionNumber(),TagList:a.tags,StartIndex:0,ItemCount:a.eventSize,IncludeTags:!0},year:-1,eventSelection:3,sortOperator:1,includePressReleases:a.news,includePresentations:a.presentations,includeFinancialReports:a.financials};return b},getPrivateEventList:function(){var b=this;url=location.href.toLowerCase(),a.ajax({type:"POST",url:"/services/EventService.svc/GetEventList",data:JSON.stringify(b.privateEventParams()),contentType:"application/json; charset=utf-8",dataType:"json",success:function(a){b.buildEventObj(a.GetEventListResult)},error:function(){console.log("Events failed to load")}})},getPublicEventList:function(){var b=this;a.ajax({type:"GET",url:b.options.url+"/feed/Event.svc/GetEventList",data:b.publicEventParams(),dataType:"jsonp",success:function(a){b.buildEventObj(a.GetEventListResult)},error:function(){console.log("Events failed to load")}})},buildEventObj:function(b){var c=this,d=[];a.each(b,function(a,b){var c=moment(b.StartDate).format("YYYY-MM-DD"),e=moment(b.EndDate).format("YYYY-MM-DD"),f={startDate:c,endDate:e,tag:b.TagsList.join(" "),items:b};d.push(f)}),c.calendar.addEvents(d),void 0!==this.options.onEventsLoad&&"function"==typeof this.options.onEventsLoad&&this.options.onEventsLoad(c.calendar,d)},getSlideShare:function(){var b=this;a.getJSON("//widgets.q4web.com/slideshare/rss/getRssByUser/"+b.options.slideshare+"?callback=?",function(a){b.parseSlideShare(a)})},parseSlideShare:function(b){var c=this,d=[];a.each(b,function(a,b){var c=moment(b.published).format("YYYY-MM-DD"),e={startDate:c,endDate:c,slideshare:!0,items:b};d.push(e)}),c.calendar.addEvents(d),void 0!==this.options.onSlideShareLoad&&"function"==typeof this.options.onSlideShareLoad&&this.options.onSlideShareLoad(c.calendar,d)},callClndr:function(){var a=this;a.calendar=a.element.clndr(a.options.calendar),a.options.publicFeed?a.getPublicEventList():a.getPrivateEventList(),a.options.slideshare.length&&a.getSlideShare()},destroy:function(){this.element.html("")},_setOption:function(){this._superApply(arguments)}})}(jQuery);